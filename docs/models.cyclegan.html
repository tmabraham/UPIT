---

title: CycleGAN model


keywords: fastai
sidebar: home_sidebar

summary: "Defines the CycleGAN model architecture."
description: "Defines the CycleGAN model architecture."
nb_path: "nbs/01_models.cyclegan.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_models.cyclegan.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We use the models that were introduced in the <a href="https://arxiv.org/abs/1703.10593">cycleGAN paper</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Generator">Generator<a class="anchor-link" href="#Generator"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="convT_norm_relu" class="doc_header"><code>convT_norm_relu</code><a href="https://github.com/tmabraham/UPIT/tree/master/upit/models/cyclegan.py#L14" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>convT_norm_relu</code>(<strong><code>ch_in</code></strong>:<code>int</code>, <strong><code>ch_out</code></strong>:<code>int</code>, <strong><code>norm_layer</code></strong>:<code>Module</code>, <strong><code>ks</code></strong>:<code>int</code>=<em><code>3</code></em>, <strong><code>stride</code></strong>:<code>int</code>=<em><code>2</code></em>, <strong><code>bias</code></strong>:<code>bool</code>=<em><code>True</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="pad_conv_norm_relu" class="doc_header"><code>pad_conv_norm_relu</code><a href="https://github.com/tmabraham/UPIT/tree/master/upit/models/cyclegan.py#L19" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>pad_conv_norm_relu</code>(<strong><code>ch_in</code></strong>:<code>int</code>, <strong><code>ch_out</code></strong>:<code>int</code>, <strong><code>pad_mode</code></strong>:<code>str</code>, <strong><code>norm_layer</code></strong>:<code>Module</code>, <strong><code>ks</code></strong>:<code>int</code>=<em><code>3</code></em>, <strong><code>bias</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>pad</code></strong>=<em><code>1</code></em>, <strong><code>stride</code></strong>:<code>int</code>=<em><code>1</code></em>, <strong><code>activ</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>init</code></strong>=<em><code>kaiming_normal_</code></em>, <strong><code>init_gain</code></strong>:<code>int</code>=<em><code>0.02</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="ResnetBlock" class="doc_header"><code>class</code> <code>ResnetBlock</code><a href="https://github.com/tmabraham/UPIT/tree/master/upit/models/cyclegan.py#L37" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>ResnetBlock</code>(<strong><code>dim</code></strong>:<code>int</code>, <strong><code>pad_mode</code></strong>:<code>str</code>=<em><code>'reflection'</code></em>, <strong><code>norm_layer</code></strong>:<code>Module</code>=<em><code>None</code></em>, <strong><code>dropout</code></strong>:<code>float</code>=<em><code>0.0</code></em>, <strong><code>bias</code></strong>:<code>bool</code>=<em><code>True</code></em>) :: <code>Module</code></p>
</blockquote>
<p>nn.Module for the ResNet Block</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="resnet_generator" class="doc_header"><code>resnet_generator</code><a href="https://github.com/tmabraham/UPIT/tree/master/upit/models/cyclegan.py#L51" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>resnet_generator</code>(<strong><code>ch_in</code></strong>:<code>int</code>, <strong><code>ch_out</code></strong>:<code>int</code>, <strong><code>n_ftrs</code></strong>:<code>int</code>=<em><code>64</code></em>, <strong><code>norm_layer</code></strong>:<code>Module</code>=<em><code>None</code></em>, <strong><code>dropout</code></strong>:<code>float</code>=<em><code>0.0</code></em>, <strong><code>n_blocks</code></strong>:<code>int</code>=<em><code>9</code></em>, <strong><code>pad_mode</code></strong>:<code>str</code>=<em><code>'reflection'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test-generator">Test generator<a class="anchor-link" href="#Test-generator"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's test for a few things:</p>
<ol>
<li>The generator can indeed be initialized correctly</li>
<li>A random image can be passed into the model successfully with the correct size output</li>
<li>The CycleGAN generator is equivalent to the <a href="https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix/blob/master/models/cycle_gan_model.py">original implementation</a></li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First let's create a random batch:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">img1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">256</span><span class="p">,</span><span class="mi">256</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">resnet_generator</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
    <span class="n">out1</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">img1</span><span class="p">)</span>
<span class="n">out1</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([4, 3, 256, 256])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m_junyanz</span> <span class="o">=</span> <span class="n">define_G</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="s1">&#39;resnet_9blocks&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;instance&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
    <span class="n">out2</span> <span class="o">=</span> <span class="n">m_junyanz</span><span class="p">(</span><span class="n">img1</span><span class="p">)</span>
<span class="n">out2</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>initialize network with normal
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([4, 3, 256, 256])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="compare_networks" class="doc_header"><code>compare_networks</code><a href="https://github.com/tmabraham/UPIT/tree/master/upit/models/cyclegan.py#L67" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>compare_networks</code>(<strong><code>a</code></strong>, <strong><code>b</code></strong>)</p>
</blockquote>
<p>A simple function to compare the printed model representations as a proxy for actually comparing two models</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">out1</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">img1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">out2</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">img1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">compare_networks</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">m_junyanz</span><span class="o">.</span><span class="n">children</span><span class="p">())[</span><span class="mi">0</span><span class="p">],</span><span class="n">m</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Passed!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Discriminator">Discriminator<a class="anchor-link" href="#Discriminator"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="conv_norm_lr" class="doc_header"><code>conv_norm_lr</code><a href="https://github.com/tmabraham/UPIT/tree/master/upit/models/cyclegan.py#L76" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>conv_norm_lr</code>(<strong><code>ch_in</code></strong>:<code>int</code>, <strong><code>ch_out</code></strong>:<code>int</code>, <strong><code>norm_layer</code></strong>:<code>Module</code>=<em><code>None</code></em>, <strong><code>ks</code></strong>:<code>int</code>=<em><code>3</code></em>, <strong><code>bias</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>pad</code></strong>:<code>int</code>=<em><code>1</code></em>, <strong><code>stride</code></strong>:<code>int</code>=<em><code>1</code></em>, <strong><code>activ</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>slope</code></strong>:<code>float</code>=<em><code>0.2</code></em>, <strong><code>init</code></strong>=<em><code>normal_</code></em>, <strong><code>init_gain</code></strong>:<code>int</code>=<em><code>0.02</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="discriminator" class="doc_header"><code>discriminator</code><a href="https://github.com/tmabraham/UPIT/tree/master/upit/models/cyclegan.py#L91" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>discriminator</code>(<strong><code>ch_in</code></strong>:<code>int</code>, <strong><code>n_ftrs</code></strong>:<code>int</code>=<em><code>64</code></em>, <strong><code>n_layers</code></strong>:<code>int</code>=<em><code>3</code></em>, <strong><code>norm_layer</code></strong>:<code>Module</code>=<em><code>None</code></em>, <strong><code>sigmoid</code></strong>:<code>bool</code>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test-discriminator">Test discriminator<a class="anchor-link" href="#Test-discriminator"> </a></h3><p>Let's test for similar things:</p>
<ol>
<li>The discriminator can indeed be initialized correctly</li>
<li>A random image can be passed into the discriminator successfully with the correct size output</li>
<li>The CycleGAN discriminator is equivalent to the <a href="https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix/blob/master/models/cycle_gan_model.py">original implementation</a></li>
</ol>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">discriminator</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
    <span class="n">out1</span> <span class="o">=</span> <span class="n">d</span><span class="p">(</span><span class="n">img1</span><span class="p">)</span>
<span class="n">out1</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([4, 1, 30, 30])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">img1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">256</span><span class="p">,</span><span class="mi">256</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">d_junyanz</span> <span class="o">=</span> <span class="n">define_D</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="s1">&#39;basic&#39;</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="s1">&#39;instance&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
    <span class="n">out2</span> <span class="o">=</span> <span class="n">d_junyanz</span><span class="p">(</span><span class="n">img1</span><span class="p">)</span>
<span class="n">out2</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>initialize network with normal
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([4, 1, 30, 30])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">out1</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">]))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">out2</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">]))</span>
<span class="k">assert</span> <span class="n">compare_networks</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">d_junyanz</span><span class="o">.</span><span class="n">children</span><span class="p">())[</span><span class="mi">0</span><span class="p">],</span><span class="n">d</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Passed!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Full-model">Full model<a class="anchor-link" href="#Full-model"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We group two discriminators and two generators in a single model, then a <code>Callback</code> (defined in <code>02_cyclegan_training.ipynb</code>) will take care of training them properly. We use the <code>PyTorchModelHubMixin</code> to provide support for pushing to and loading from the <a href="https://huggingface.co/docs/hub/main">HuggingFace Hub</a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="CycleGAN" class="doc_header"><code>class</code> <code>CycleGAN</code><a href="https://github.com/tmabraham/UPIT/tree/master/upit/models/cyclegan.py#L106" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>CycleGAN</code>(<strong><code>ch_in</code></strong>:<code>int</code>=<em><code>3</code></em>, <strong><code>ch_out</code></strong>:<code>int</code>=<em><code>3</code></em>, <strong><code>n_features</code></strong>:<code>int</code>=<em><code>64</code></em>, <strong><code>disc_layers</code></strong>:<code>int</code>=<em><code>3</code></em>, <strong><code>gen_blocks</code></strong>:<code>int</code>=<em><code>9</code></em>, <strong><code>lsgan</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>drop</code></strong>:<code>float</code>=<em><code>0.0</code></em>, <strong><code>norm_layer</code></strong>:<code>Module</code>=<em><code>None</code></em>) :: <code>Module</code></p>
</blockquote>
<p>CycleGAN model.</p>
<p>When called, takes in input batch of real images from both domains and outputs fake images for the opposite domains (with the generators).
Also outputs identity images after passing the images into generators that outputs its domain type (needed for identity loss).</p>
<p>Attributes:</p>
<p><code>G_A</code> (<code>nn.Module</code>): takes real input B and generates fake input A</p>
<p><code>G_B</code> (<code>nn.Module</code>): takes real input A and generates fake input B</p>
<p><code>D_A</code> (<code>nn.Module</code>): trained to make the difference between real input A and fake input A</p>
<p><code>D_B</code> (<code>nn.Module</code>): trained to make the difference between real input B and fake input B</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="CycleGAN.__init__" class="doc_header"><code>CycleGAN.__init__</code><a href="https://github.com/tmabraham/UPIT/tree/master/upit/models/cyclegan.py#L118" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>CycleGAN.__init__</code>(<strong><code>ch_in</code></strong>:<code>int</code>=<em><code>3</code></em>, <strong><code>ch_out</code></strong>:<code>int</code>=<em><code>3</code></em>, <strong><code>n_features</code></strong>:<code>int</code>=<em><code>64</code></em>, <strong><code>disc_layers</code></strong>:<code>int</code>=<em><code>3</code></em>, <strong><code>gen_blocks</code></strong>:<code>int</code>=<em><code>9</code></em>, <strong><code>lsgan</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>drop</code></strong>:<code>float</code>=<em><code>0.0</code></em>, <strong><code>norm_layer</code></strong>:<code>Module</code>=<em><code>None</code></em>)</p>
</blockquote>
<p>Constructor for CycleGAN model.</p>
<p>Arguments:</p>
<p><code>ch_in</code> (<code>int</code>): Number of input channels (default=3)</p>
<p><code>ch_out</code> (<code>int</code>): Number of output channels (default=3)</p>
<p><code>n_features</code> (<code>int</code>): Number of input features (default=64)</p>
<p><code>disc_layers</code> (<code>int</code>): Number of discriminator layers (default=3)</p>
<p><code>gen_blocks</code> (<code>int</code>): Number of residual blocks in the generator (default=9)</p>
<p><code>lsgan</code> (<code>bool</code>): LSGAN training objective (output unnormalized float) or not? (default=True)</p>
<p><code>drop</code> (<code>float</code>): Level of dropout (default=0)</p>
<p><code>norm_layer</code> (<code>nn.Module</code>): Type of normalization layer to use in the models (default=None)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="CycleGAN.forward" class="doc_header"><code>CycleGAN.forward</code><a href="https://github.com/tmabraham/UPIT/tree/master/upit/models/cyclegan.py#L145" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>CycleGAN.forward</code>(<strong><code>input</code></strong>)</p>
</blockquote>
<p>Forward function for CycleGAN model. The input is a tuple of a batch of real images from both domains A and B.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ModelHubMixin.push_to_hub" class="doc_header"><code>ModelHubMixin.push_to_hub</code><a href="huggingface_hub/hub_mixin.py#L211" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ModelHubMixin.push_to_hub</code>(<strong><code>repo_path_or_name</code></strong>:<code>Optional</code>[<code>str</code>]=<em><code>None</code></em>, <strong><code>repo_url</code></strong>:<code>Optional</code>[<code>str</code>]=<em><code>None</code></em>, <strong><code>commit_message</code></strong>:<code>Optional</code>[<code>str</code>]=<em><code>'Add model'</code></em>, <strong><code>organization</code></strong>:<code>Optional</code>[<code>str</code>]=<em><code>None</code></em>, <strong><code>private</code></strong>:<code>Optional</code>[<code>bool</code>]=<em><code>None</code></em>, <strong><code>api_endpoint</code></strong>:<code>Optional</code>[<code>str</code>]=<em><code>None</code></em>, <strong><code>use_auth_token</code></strong>:<code>Union</code>[<code>bool</code>, <code>str</code>, <code>NoneType</code>]=<em><code>None</code></em>, <strong><code>git_user</code></strong>:<code>Optional</code>[<code>str</code>]=<em><code>None</code></em>, <strong><code>git_email</code></strong>:<code>Optional</code>[<code>str</code>]=<em><code>None</code></em>, <strong><code>config</code></strong>:<code>Optional</code>[<code>dict</code>]=<em><code>None</code></em>)</p>
</blockquote>
<p>Upload model checkpoint or tokenizer files to the Hub while
synchronizing a local clone of the repo in <code>repo_path_or_name</code>.</p>
<p>Parameters:
    repo_path_or_name (<code>str</code>, <em>optional</em>):
        Can either be a repository name for your model or tokenizer in
        the Hub or a path to a local folder (in which case the
        repository will have the name of that local folder). If not
        specified, will default to the name given by <code>repo_url</code> and a
        local directory with that name will be created.
    repo_url (<code>str</code>, <em>optional</em>):
        Specify this in case you want to push to an existing repository
        in the hub. If unspecified, a new repository will be created in
        your namespace (unless you specify an <code>organization</code>) with
        <code>repo_name</code>.
    commit_message (<code>str</code>, <em>optional</em>):
        Message to commit while pushing. Will default to <code>"add config"</code>,
        <code>"add tokenizer"</code> or <code>"add model"</code> depending on the type of the
        class.
    organization (<code>str</code>, <em>optional</em>):
        Organization in which you want to push your model or tokenizer
        (you must be a member of this organization).
    private (<code>bool</code>, <em>optional</em>):
        Whether the repository created should be private.
    api_endpoint (<code>str</code>, <em>optional</em>):
        The API endpoint to use when pushing the model to the hub.
    use_auth_token (<code>bool</code> or <code>str</code>, <em>optional</em>):
        The token to use as HTTP bearer authorization for remote files.
        If <code>True</code>, will use the token generated when running
        <code>transformers-cli login</code> (stored in <code>~/.huggingface</code>). Will
        default to <code>True</code> if <code>repo_url</code> is not specified.
    git_user (<code>str</code>, <em>optional</em>):
        will override the <code>git config user.name</code> for committing and
        pushing files to the hub.
    git_email (<code>str</code>, <em>optional</em>):
        will override the <code>git config user.email</code> for committing and
        pushing files to the hub.
    config (<code>dict</code>, <em>optional</em>):
        Configuration object to be saved alongside the model weights.</p>
<p>Returns:
    The url of the commit of your model in the given repository.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ModelHubMixin.from_pretrained" class="doc_header"><code>ModelHubMixin.from_pretrained</code><a href="huggingface_hub/hub_mixin.py#L73" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ModelHubMixin.from_pretrained</code>(<strong><code>pretrained_model_name_or_path</code></strong>:<code>str</code>, <strong><code>force_download</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>resume_download</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>proxies</code></strong>:<code>Dict</code>=<em><code>None</code></em>, <strong><code>use_auth_token</code></strong>:<code>Optional</code>[<code>str</code>]=<em><code>None</code></em>, <strong><code>cache_dir</code></strong>:<code>Optional</code>[<code>str</code>]=<em><code>None</code></em>, <strong><code>local_files_only</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong>**<code>model_kwargs</code></strong>)</p>
</blockquote>
<p>Instantiate a pretrained PyTorch model from a pre-trained model
        configuration from huggingface-hub. The model is set in
        evaluation mode by default using <code>model.eval()</code> (Dropout modules
        are deactivated). To train the model, you should first set it
        back in training mode with <code>model.train()</code>.</p>

<pre><code>    Parameters:
        pretrained_model_name_or_path (`str` or `os.PathLike`):
            Can be either:
                - A string, the `model id` of a pretrained model
                  hosted inside a model repo on huggingface.co.
                  Valid model ids can be located at the root-level,
                  like `bert-base-uncased`, or namespaced under a
                  user or organization name, like
                  `dbmdz/bert-base-german-cased`.
                - You can add `revision` by appending `@` at the end
                  of model_id simply like this:
                  `dbmdz/bert-base-german-cased@main` Revision is
                  the specific model version to use. It can be a
                  branch name, a tag name, or a commit id, since we
                  use a git-based system for storing models and
                  other artifacts on huggingface.co, so `revision`
                  can be any identifier allowed by git.
                - A path to a `directory` containing model weights
                  saved using
                  [`~transformers.PreTrainedModel.save_pretrained`],
                  e.g., `./my_model_directory/`.
                - `None` if you are both providing the configuration
                  and state dictionary (resp. with keyword arguments
                  `config` and `state_dict`).
        force_download (`bool`, *optional*, defaults to `False`):
            Whether to force the (re-)download of the model weights
            and configuration files, overriding the cached versions
            if they exist.
        resume_download (`bool`, *optional*, defaults to `False`):
            Whether to delete incompletely received files. Will
            attempt to resume the download if such a file exists.
        proxies (`Dict[str, str]`, *optional*):
            A dictionary of proxy servers to use by protocol or
            endpoint, e.g., `{'http': 'foo.bar:3128',
            'http://hostname': 'foo.bar:4012'}`. The proxies are
            used on each request.
        use_auth_token (`str` or `bool`, *optional*):
            The token to use as HTTP bearer authorization for remote
            files. If `True`, will use the token generated when
            running `transformers-cli login` (stored in
            `~/.huggingface`).
        cache_dir (`Union[str, os.PathLike]`, *optional*):
            Path to a directory in which a downloaded pretrained
            model configuration should be cached if the standard
            cache should not be used.
        local_files_only(`bool`, *optional*, defaults to `False`):
            Whether to only look at local files (i.e., do not try to
            download the model).
        model_kwargs (`Dict`, *optional*):
            model_kwargs will be passed to the model during
            initialization

    &lt;Tip&gt;

    Passing `use_auth_token=True` is required when you want to use a
    private model.

    &lt;/Tip&gt;</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Quick-model-tests">Quick model tests<a class="anchor-link" href="#Quick-model-tests"> </a></h3><p>Again, let's check that the model can be called sucsessfully and outputs the correct shapes.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cyclegan_model</span> <span class="o">=</span> <span class="n">CycleGAN</span><span class="p">()</span>
<span class="n">img1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">256</span><span class="p">,</span><span class="mi">256</span><span class="p">)</span>
<span class="n">img2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">256</span><span class="p">,</span><span class="mi">256</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span> <span class="n">cyclegan_output</span> <span class="o">=</span> <span class="n">cyclegan_model</span><span class="p">((</span><span class="n">img1</span><span class="p">,</span><span class="n">img2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 1min 15s, sys: 6.67 s, total: 1min 22s
Wall time: 2.25 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cyclegan_output</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
<span class="k">for</span> <span class="n">output_batch</span> <span class="ow">in</span> <span class="n">cyclegan_output</span><span class="p">:</span>
    <span class="n">test_eq</span><span class="p">(</span><span class="n">output_batch</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">img1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cyclegan_model</span><span class="o">.</span><span class="n">push_to_hub</span><span class="p">(</span><span class="s1">&#39;upit-cyclegan-test&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Cloning https://huggingface.co/tmabraham/upit-cyclegan-test into local empty directory.
To https://huggingface.co/tmabraham/upit-cyclegan-test
   a41e9e0..2331f7d  main -&gt; main

</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;https://huggingface.co/tmabraham/upit-cyclegan-test/commit/2331f7d345d719ac1fdfb10b2cddf58abd7931bb&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#hide_output</span>
<span class="n">cyclegan_model</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s1">&#39;tmabraham/upit-cyclegan-test&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>


